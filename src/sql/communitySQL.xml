<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="comm">      

  <typeAlias alias="codto" type="jackpot.DTO.communityDTO"/>


      <select id="commList" resultClass="codto">
            select com_num,title,content,writer,reg_date,readcount,recommend,ref,re_step,re_level from community order by com_num asc
      </select>


       <insert id="insertComm" parameterClass="codto">
     insert into community(com_num,title,content,writer,readcount,recommend,btype,emp_num) 
            values(community_seq.nextval,#title#,#content#,#writer#,0,0,1,#emp_num#)
       </insert>

      <update id="readCount" parameterClass="int">
      update community set readcount=readcount+1 where com_num =#com_num#
      </update>
    
    <select id="content" resultClass="codto"  parameterClass="int">
            select com_num,title,content,writer,reg_date,readcount,recommend,ref,re_step,re_level from community where com_num =#com_num#
      </select>
    
      <update id="recommend" parameterClass="int">
      update community set recommend=recommend+1 , readcount=readcount-1 where com_num =#com_num#
      </update>
    
        
         <insert id="insertComment" parameterClass="codto">
      insert into reply(rep_num,content,ref,re_step,re_level,re_num,emp_name,re_date) 
      values(reply_seq.nextval,#content#,#ref#,#re_step#,#re_level#,#re_num#,#emp_name#,sysdate)
         </insert>
        
        <select id="reply" resultClass="codto" parameterClass="int">
        select r.rep_num,r.content,r.ref,r.re_num,r.re_date,e.emp_num,e.emp_name
            from  reply r,emp e where r.re_num=e.emp_num and r.ref=#ref# order by re_date desc
        </select>
        
        <select id="count" resultClass="int">
            select count(*)from reply where ref=#ref#       
        </select>
        
        <delete id="deleteReply" parameterClass="int">
            delete  from reply where rep_num=#rep_num#
        </delete>
        
        
        
</sqlMap>